@{
    ViewData["Title"] = "Search Documents";
}

<div class="container mx-2">
    <form id="searchForm">
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="SubmissionDateFrom" class="form-label">Submission Date From</label>
                <input type="date" class="form-control" id="SubmissionDateFrom" name="SubmissionDateFrom">
            </div>
            <div class="col-md-3">
                <label for="SubmissionDateTo" class="form-label">Submission Date To</label>
                <input type="date" class="form-control" id="SubmissionDateTo" name="SubmissionDateTo">
            </div>
            <div class="col-md-3">
                <label for="IssueDateFrom" class="form-label">Issue Date From</label>
                <input type="date" class="form-control" id="IssueDateFrom" name="IssueDateFrom">
            </div>
            <div class="col-md-3">
                <label for="IssueDateTo" class="form-label">Issue Date To</label>
                <input type="date" class="form-control" id="IssueDateTo" name="IssueDateTo">
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="Status" class="form-label">Status</label>
                <select class="form-control" id="Status" name="Status">
                    <option value="Valid">Valid</option>
                    <option value="Invalid">Invalid</option>
                    <option value="Rejected">Rejected</option>
                    <option value="Cancelled">Cancelled</option>
                    <option value="Submitted">Submitted</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="DocumentType" class="form-label">Document Type</label>
                <select class="form-control" id="DocumentType" name="DocumentType">
                    <option value="">-- Select Document Type --</option>
                    <option value="i">Invoice</option>
                    <option value="c">Credit Note</option>
                    <option value="d">Debit Note</option>
                    <option value="ii">Import Invoice</option>
                    <option value="ei">Export Invoice</option>
                    <option value="ec">Export Credit Note</option>
                    <option value="ed">Export Debit Note</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="ReceiverType" class="form-label">Receiver Type</label>
                <select class="form-control" id="ReceiverType" name="ReceiverType">
                    <option value="">-- Select Receiver Type --</option>
                    <option value="B">Business</option>
                    <option value="F">Foreigner</option>
                    <option value="P">Person</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="ReceiverId" class="form-label">Receiver ID</label>
                <input type="text" class="form-control" id="ReceiverId" name="ReceiverId">
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="IssuerType" class="form-label">Issuer Type</label>
                <select class="form-control" id="IssuerType" name="IssuerType">
                    <option value="">-- Select Issuer Type --</option>
                    <option value="B">Business</option>
                    <option value="F">Foreigner</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="IssuerId" class="form-label">Issuer ID</label>
                <input type="text" class="form-control" id="IssuerId" name="IssuerId">
            </div>
            <div class="col-md-3">
                <label for="UUID" class="form-label">UUID</label>
                <input type="text" class="form-control" id="UUID" name="UUID">
            </div>
            <div class="col-md-3">
                <label for="InternalID" class="form-label">Internal ID</label>
                <input type="text" class="form-control" id="InternalID" name="InternalID">
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
</div>

<div class="container mx-2">
    <table id="DocumentsTable" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>#</th>
                <th>Submission Date</th>
                <th>Issue Date</th>
                <th>Status</th>
                <th>Document Type</th>
                <th>Receiver</th>
                <th>Issuer</th>
                <th>UUID</th>
                <th>Internal ID</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        var table = $('#DocumentsTable').DataTable({
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url": "@Url.Action("LoadDocuments", "Documents")",
                "type": "POST",
                "contentType": "application/json;",
                "data": function (d) {
                    return JSON.stringify({
                        SubmissionDateFrom: $('#submissionDateFrom').val(),
                        SubmissionDateTo: $('#submissionDateTo').val(),
                        IssueDateFrom: $('#issueDateFrom').val(),
                        IssueDateTo: $('#issueDateTo').val(),
                        ContinuationToken: "",
                        PageSize: 10,
                        Direction: "",
                        Status: $('#status').val(),
                        DocumentType: $('#documentType').val(),
                        ReceiverType: $('#receiverType').val(),
                        ReceiverId: $('#receiverId').val(),
                        IssuerType: $('#issuerType').val(),
                        IssuerId: $('#issuerId').val(),
                        UUID: $('#uUID').val(),
                        InternalID: $('#internalID').val()
                    });
                }
            },
            "columns": [
                { "data": "serial" },
                { "data": "submissionDate" },
                { "data": "issueDate" },
                { "data": "status" },
                { "data": "documentType" },
                { "data": "receiver" },
                { "data": "issuer" },
                {
                    "data": "uuid",
                    "render": function (data, type, row) {
                        if (type === 'display') {
                            return '<a href="' + row.publicUrl + '" target="_blank">' + data + '</a>';
                        }
                        return data;
                    }
                },
                { "data": "internalID" },
                {
                    "data": null,
                    "render": function (data, type, row) {
                        var buttons = '';
                        switch (row.status) {
                            case 'Submitted':
                                buttons = '<button class="btn btn-primary btn-sm">Reject</button> ' +
                                    '<button class="btn btn-danger btn-sm">Decline</button>';
                                break;
                            case 'Valid':
                            case 'Invalid':
                                buttons = '<button class="btn btn-primary btn-sm">View Details</button>';
                                break;
                            case 'Rejected':
                            case 'Cancelled':
                                buttons = '<button class="btn btn-primary btn-sm">View Reason</button>';
                                break;
                            default:
                                break;
                        }
                        return buttons;
                    }
                }
            ]
        });

        $('#searchForm').on('submit', function (e) {
            e.preventDefault();
            table.ajax.reload();
        });

        function setDefaultSubmissionDates() {
            var today = new Date();
            var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);

            var submissionDateFrom = firstDayOfMonth.toISOString().split('T')[0];
            var submissionDateTo = today.toISOString().split('T')[0];

            $('#SubmissionDateFrom').val(submissionDateFrom);
            $('#SubmissionDateTo').val(submissionDateTo);
        }

        setDefaultSubmissionDates();
    });
</script>
